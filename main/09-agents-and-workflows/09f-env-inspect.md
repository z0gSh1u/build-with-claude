# 09f - 环境感知

在构建 AI 代理时，一个经常被忽视的关键概念是环境检查。Claude 在盲目的操作——它需要能够观察和理解其行动的结果，才能有效地工作。

思考一下 Claude 如何与计算机使用协同工作。每当 Claude 执行诸如输入文本或点击按钮等操作时，它会立即收到一张截图来了解发生了什么。这不仅仅是一个锦上添花的特性——这是必需的。

![img](09f-env-inspect.assets/instructor%2Fa46l9irobhg0f5webscixp0bs%2Fpublic%2F1748543181%2F11_-_006_-_Environment_Inspection_00.1748543181585.jpg)

从克劳德的视角来看，点击一个按钮可以跳转到新页面、打开菜单或触发一系列变化。由于无法看到结果，克劳德无法理解其操作是否成功或环境的新状态是什么样的。

## 阅读在写作之前

此原则同样适用于文件操作。在 Claude 修改任何文件之前，它需要了解当前的内容。这看起来可能很显然，但这是构建代理时始终应遵循的模式。

![img](09f-env-inspect.assets/instructor%2Fa46l9irobhg0f5webscixp0bs%2Fpublic%2F1748543182%2F11_-_006_-_Environment_Inspection_08.1748543182126.jpg)

在上述示例中，当被要求向 Python 文件中添加新路由时，Claude 首先阅读现有代码以了解当前结构。只有在这种情况下，它才能安全地做出所需更改而不会破坏现有功能。

## 系统提示词引导环境感知

您可以通过系统提示引导 Claude 检查其环境。对于像视频生成这样的复杂任务，这尤为重要。

![img](09f-env-inspect.assets/instructor%2Fa46l9irobhg0f5webscixp0bs%2Fpublic%2F1748543182%2F11_-_006_-_Environment_Inspection_11.1748543182591.jpg)

考虑一个需要以下功能的视频创作代理：

- 使用 FFmpeg 等工具生成视频内容
- 验证音频对话是否放置正确
- 检查视觉元素是否如预期出现

您可能包括系统提示指令，例如：

- 使用 bash 工具运行 whisper.cpp 并生成带时间戳的字幕文件以验证对话位置
- 使用 FFmpeg 以固定间隔从视频中提取截图以直观检查输出
- 将生成内容与原始需求进行比较

## 环境检查的好处

当克劳德能够检查其环境时，几件事情会得到改善：

- 更好的进度跟踪 - Claude 可以评估它完成任务的进度有多接近
- 错误处理 - 可以检测并纠正意外结果
- 质量保证 - 在认为任务完成之前，可以对输出进行验证
- 自适应行为 - Claude 可以根据观察到的内容调整其方法

## 实际应用

在设计自己的代理时，始终要问：“Claude 如何知道这个动作是否成功？”无论您是在处理文件、API 还是用户界面，都应提供工具和说明，让 Claude 能够观察其动作的结果。例如：

- 在修改前读取文件内容
- 在 UI 交互后截取屏幕
- 检查 API 响应以获取预期数据
- 验证生成内容是否符合要求

环境检查将克劳德从盲目执行命令的执行者转变为能够真正理解和适应其工作环境的代理。

