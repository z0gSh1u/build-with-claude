# 06b - 图像理解

Claude 的视觉模态能力让你可以在消息中包含图片，并要求 Claude 以各种方式分析它们，例如描述图片中的内容、比较多张图片、物体计数等。

## 如何使用

首先需要注意如下限制：

- 单次请求最多可包含 100 张图片，每张图片最大为 5MB
- 发送单张图片时，最大高/宽为 8000 像素；发送多张图片时，最大高/宽为 2000 像素
- 图片可以以 Base64 发送，也可以以 URL 发送
- 每张图片占用的 Token 数近似为 `width * height / 750`

对话的工作方式与仅文本交互类似，在消息中包含一个图片 Block 即可实现：

```python
# 读取图片为 Base64 字符串
with open("image.png", "rb") as f:
    image_bytes = base64.standard_b64encode(f.read()).decode("utf-8")

add_user_message(messages, [
    # 图片 Block
    {
        "type": "image",
        "source": {
            "type": "base64",
            "media_type": "image/png",
            "data": image_bytes,
        }
    },
    # 文本 Block
    {
        "type": "text",
        "text": "What do you see in this image?"
    }
])
```

## 一个例子

在需要 Claude 针对图片得出结果时，提示词技巧很重要，简单的提示词往往效果不佳。例如：

![img](06b-image.assets/1.jpg)

只是询问“这张图片里有多少个弹珠？”很可能得到错误的计数。而通过：

- 提供详细的步骤
- 使用 Few-Shot 示例
- 将复杂任务分解为子任务

的方式，能显著提高 Claude 的准确性。以下是“提供步骤”的示例：

```
分析这张弹珠图片，并按照以下方法确定精确数量：
1. 逐一识别每一颗弹珠，识别时为每颗分配编号。
2. 用不同的方法核对结果，比如从左下角开始，按行从左到右计数。

这张图片中弹珠的确切的、已核实的数量是多少？
```

![img](./06b-image.assets/2.jpg)

以下则是提供 Few-Shot 示例的做法，即携带一张已知数量的图片并说明正确答案，然后再询问目标图片；这为 Claude 提供了一个参考，有助于它了解你想要进行的具体图像分析任务：

![img](./06b-image.assets/3.jpg)

本节的代码在 [06b.ipynb](./06b.ipynb)。

## 另一个更真实的例子

考虑为保险公司实现自动化的火灾风险评估。他们不必派检查员到每一处房产，而是可以使用卫星图像和 Claude 的分析。

![img](./06b-image.assets/4.jpg)

正如上一个例子，我们可以用详细的提示词引导 Claude 一步步进行系统分析：

```
分析所附的房产卫星图像，按以下具体步骤进行：

1. 住宅识别：找到房产地块上的主要住宅，依据：
   - 最大的有屋顶结构
   - 典型住宅特征（与车道相连、规则的几何形状）
   - 与其他结构（车库、工具房、泳池）区分开

2. 树冠遮盖分析：检查主要住宅附近的所有树木：
   - 识别任何树冠直接延伸至屋顶任一部分的树木
   - 估算树冠覆盖屋顶的百分比（0–25%、25–50%、50–75%、75%+）
   - 标注覆盖特别密集的区域

3. 火险评估：对于任何有覆盖的树木，评估：
   - 潜在的野火易损性（易接住火星的点、通向建筑的连续燃料路径）
   - 与烟囱、通风口或其他可见屋顶开口的接近程度
   - 枝干是否在野外植被与建筑之间构成“桥梁”

4. 防御空间识别：评估房产的整体植被结构：
   - 判断树木是否相互连接在住宅上方或附近形成连续树冠
   - 标注任何明显的燃料阶梯（可将火从地面蔓延到树冠再到屋顶的植被）

5. 火险评级：根据你的分析，给出 1–4 的火险评级：
   - 等级 1（低风险）：无树枝悬垂屋顶，住宅周围有良好防御空间
   - 等级 2（中等风险）：轻微悬垂（<25% 屋顶），树冠之间有一定间隔
   - 等级 3（高风险）：显著悬垂（25–50% 屋顶），树冠相连，存在多个脆弱点
   - 等级 4（极高风险）：广泛悬垂（>50% 屋顶），密集植被靠近建筑

对于以上每一项（1–5），用一句话总结你的发现，最终回答为数值评级。
```

而不仅仅是一句像“提供火灾风险评分”这样简单的提示。详细、结构化的提示比简单的请求更有助于 Claude 提供准确和有用的评估。
