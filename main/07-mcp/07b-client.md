# 07b - MCP 客户端

MCP 客户端是你的服务器与 MCP 服务器之间的通信桥梁。把它想象成您访问 MCP 服务器提供的所有工具的入口点。当您需要使用外部工具或服务时，客户端会为您处理所有消息传递和协议细节。

## 传输无关的通信

MCP 的一个关键优势是它无关传输——这是一种高级的说法，意思是客户端和服务器可以使用不同的通信方法进行交流。最常见的设置是在同一台机器上运行 MCP 客户端和服务器，它们通过标准输入/输出进行通信。

但你并不局限于那种方法。MCP 客户端和服务器也可以通过以下方式连接：

- HTTP
- WebSockets
- 各种其他网络协议

## 消息类型

一旦连接，客户端和服务器将交换 MCP 规范中定义的特定消息类型。您将主要处理的消息类型有：

- ListToolsRequest/ListToolsResult: 客户端向服务器询问"您提供哪些工具"，并获取一份可用工具的列表。
- CallToolRequest/CallToolResult: 客户端请求服务器运行特定工具并传入某些参数，然后接收结果。

## 完整流程示例

以下是真实场景中所有部件如何协同工作的方式。假设一个用户询问"我有哪些仓库？"——以下是完整的通信流程：

![img](./07b-client.assets/1.jpg)

- 该过程始于用户向您的服务器提交查询。您的服务器意识到在发起请求之前需要向 Claude 提供一份可用工具的列表。
- 您的服务器向 MCP 客户端请求工具，客户端向 MCP 服务器发送 `ListToolsRequest` ，并接收 `ListToolsResult` 返回。
- 现在您的服务器已经拥有向 Claude 发起初始请求所需的一切，包括用户的问题和可用的工具。
- 克劳德检查了工具，并决定需要调用一个来回答这个问题。它以工具使用请求进行回应。
- 您的服务器要求 MCP 客户端执行 Claude 请求的工具。MCP 客户端向 MCP 服务器发送 `CallToolRequest` ，然后由 MCP 服务器向 GitHub 发起实际请求。
- GitHub 返回仓库数据，这些数据通过 MCP 服务器作为 `CallToolResult` 流回，然后到 MCP 客户端，最后到您的服务器。
- 您的服务器通过后续消息将工具结果发送回 Claude。Claude 现在拥有它所需的所有信息，可以形成完整的回复。
- 最后，Claude 返回格式化的答案，你的服务器将其传递回用户。

是的，这个流程涉及很多步骤，但每个组件都有明确的职责。MCP 客户端抽象了服务器通信的复杂性，让你专注于构建应用程序逻辑。随着我们实现自己的 MCP 客户端和服务器，你会看到每个部分在实际中是如何组合在一起的。
